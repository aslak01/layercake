import{S as y,i as k,s as v,e as B,t as D,c as x,a as O,h as C,d as m,b as g,f as N,g as S,G as T,N as q,H as w,aP as z}from"./vendor-2ea78382.js";import{k as E}from"./Brush.html-f1e0b39f.js";import{d as I}from"./downloadBlob-f865e357.js";function J(r){let e,o,t,p;return{c(){e=B("button"),o=D("Download \xA0\xA0\xA0\xA0\xA0"),this.h()},l(l){e=x(l,"BUTTON",{title:!0,class:!0,style:!0});var i=O(e);o=C(i,"Download \xA0\xA0\xA0\xA0\xA0"),i.forEach(m),this.h()},h(){e.disabled=r[0],g(e,"title","download zip file"),g(e,"class","icon svelte-1gef78k"),N(e,"background-image","url(/icons/download.svg)")},m(l,i){S(l,e,i),T(e,o),t||(p=q(e,"click",r[1]),t=!0)},p(l,[i]){i&1&&(e.disabled=l[0])},i:w,o:w,d(l){l&&m(e),t=!1,p()}}}function L(r=""){return(r.match(/from\s'(.+)'?/gm)||[]).map(t=>t.replace(/(from |'|"|;)/g,"")).filter(t=>!t.startsWith("."))}function M(r,e,o){let{data:t={}}=e,{slug:p}=e,{ssr:l=!1}=e,i=!1;const h=[t.main,...t.components,...t.componentComponents].reduce((a,n)=>a.concat(L(n.contents)),[]).reduce((a,n)=>(a.includes(n)||a.push(n),a),[]);async function _(){o(0,i=!0);const a=new Date().getTime(),n=await(await window.fetch(`/svelte-app.json?${a}`)).json(),d=await(await window.fetch(`/deps.json?${a}`)).json();if(h.length>0){const s=n.findIndex(({path:c})=>c==="package.json"),u=JSON.parse(n[s].data),f={},b={};h.forEach(c=>{if(c==="layercake")f[c]=d[c];else{if(c==="svelte")return;f[c]=d[c]}!d[c]&&c!=="layercake"&&window.alert(`Missing dependency, add "${c}" to this repo's package.json`)}),Object.assign(u.dependencies,f),Object.assign(u.devDependencies,b),n[s].data=JSON.stringify(u,null,"  ")}n.push(...t.components.map(s=>({path:`src/routes/${s.title.replace("./","")}`,data:s.contents}))),n.push(...t.modules.map(s=>({path:`src/routes/${s.title.replace("./","")}`,data:s.contents}))),n.push(...t.componentModules.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push(...t.componentComponents.map(s=>({path:`src/routes/${s.title}`,data:s.contents}))),n.push(...t.csvs.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push(...t.jsons.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push({path:"src/routes/index.svelte",data:t.main.contents}),console.log("here");const j=E(n.filter(Boolean),"path",!1);I(z(j),`layercake-${l?"ssr-":""}${p}.zip`),o(0,i=!1)}return r.$$set=a=>{"data"in a&&o(2,t=a.data),"slug"in a&&o(3,p=a.slug),"ssr"in a&&o(4,l=a.ssr)},[i,_,t,p,l]}class G extends y{constructor(e){super();k(this,e,M,J,v,{data:2,slug:3,ssr:4})}}function H(r){const e=r.split("/"),o=e[e.length-1].split(".");return o.pop(),o.join(".").toLowerCase()}export{G as D,H as c};
