import{S as y,i as k,s as v,e as B,t as D,c as x,a as O,h as C,d as g,b as w,f as N,g as S,G as T,N as q,H as _,aO as z}from"./vendor-87779d46.js";import{k as E}from"./Brush.html-531bdddd.js";import{d as I}from"./downloadBlob-f865e357.js";function J(r){let t,o,e,d;return{c(){t=B("button"),o=D("Download \xA0\xA0\xA0\xA0\xA0"),this.h()},l(l){t=x(l,"BUTTON",{title:!0,class:!0,style:!0});var c=O(t);o=C(c,"Download \xA0\xA0\xA0\xA0\xA0"),c.forEach(g),this.h()},h(){t.disabled=r[0],w(t,"title","download zip file"),w(t,"class","icon svelte-1gef78k"),N(t,"background-image","url(/icons/download.svg)")},m(l,c){S(l,t,c),T(t,o),e||(d=q(t,"click",r[1]),e=!0)},p(l,[c]){c&1&&(t.disabled=l[0])},i:_,o:_,d(l){l&&g(t),e=!1,d()}}}function L(r=""){return(r.match(/from\s'(.+)'?/gm)||[]).map(e=>e.replace(/(from |'|"|;)/g,"")).filter(e=>!e.startsWith("."))}function M(r,t,o){let{data:e={}}=t,{slug:d}=t,{ssr:l=!1}=t,c=!1;const f=[e.main,...e.components,...e.componentComponents].reduce((a,n)=>a.concat(L(n.contents)),[]).reduce((a,n)=>(a.includes(n)||a.push(n),a),[]);async function j(){o(0,c=!0);const a=new Date().getTime(),n=await(await window.fetch(`/svelte-app.json?${a}`)).json(),p=await(await window.fetch(`/deps.json?${a}`)).json();if(f.length>0){const s=n.findIndex(({path:i})=>i==="package.json"),u=JSON.parse(n[s].data),h={},m={};f.forEach(i=>{if(i==="layercake")m[i]=p[i];else{if(i==="svelte")return;h[i]=p[i]}p[i]||window.alert(`Missing dependency, add "${i}" to layercake.graphic's package.json`)}),Object.assign(u.dependencies,h),Object.assign(u.devDependencies,m),n[s].data=JSON.stringify(u,null,"  ")}n.push(...e.components.map(s=>({path:`src/routes/${s.title.replace("./","")}`,data:s.contents}))),n.push(...e.modules.map(s=>({path:`src/routes/${s.title.replace("./","")}`,data:s.contents}))),n.push(...e.componentModules.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push(...e.componentComponents.map(s=>({path:`src/routes/${s.title}`,data:s.contents}))),n.push(...e.csvs.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push(...e.jsons.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push({path:"src/routes/index.svelte",data:e.main.contents}),console.log("here");const b=E(n.filter(Boolean),"path",!1);I(z(b),`layercake-${l?"ssr-":""}${d}.zip`),o(0,c=!1)}return r.$$set=a=>{"data"in a&&o(2,e=a.data),"slug"in a&&o(3,d=a.slug),"ssr"in a&&o(4,l=a.ssr)},[c,j,e,d,l]}class H extends y{constructor(t){super();k(this,t,M,J,v,{data:2,slug:3,ssr:4})}}function P(r){const t=r.split("/"),o=t[t.length-1].split(".");return o.pop(),o.join(".").toLowerCase()}export{H as D,P as c};
