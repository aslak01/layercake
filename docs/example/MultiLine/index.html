<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta content="Layer Cake" name=description> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#ff3e00 name=theme-color> <link href=/layercake-logo-100.png rel=icon type=image/png> <meta content=https://layercake.graphics property=og:site_name> <meta content=article property=og:type> <meta content=summary_large_image name=twitter:card> <meta content=https://layercake.graphics/layercake-logo-1200.png property=og:image> <meta content="A framework for mostly-reusable graphics with svelte" property=og:description> <meta content="A framework for mostly-reusable graphics with svelte" name=description> <meta content="layercake, graphics, svelte, graphics framework, svelte graphics framework, data viz, data visualization, reusable, mostly-reusable" name=keywords> <meta content=https://layercake.graphics property=og:url> <link href=https://layercake.graphics/favicon.png rel="shortcut icon" type=image/png> <meta content=https://layercake.graphics name=twitter:site> <meta content=https://layercake.graphics/layercake-logo-1200.png name=twitter:image> <title>Multiline (html labels + quadtree tooltip)</title> <link href=/_app/start-101ba072.js rel=modulepreload> <link href=/_app/chunks/vendor-1c734409.js rel=modulepreload> <link href=/_app/chunks/singletons-12a22614.js rel=modulepreload> <link href=/_app/pages/__layout.svelte-9e5a1370.js rel=modulepreload> <link href=/_app/chunks/GuideContents-583e3fd9.js rel=modulepreload> <link href=/_app/chunks/_examples-a40eb85c.js rel=modulepreload> <link href=/_app/chunks/Brush.html-edfccaa9.js rel=modulepreload> <link href=/_app/chunks/dots-a99dc468.js rel=modulepreload> <link href=/_app/chunks/pointsFour-ad3813a0.js rel=modulepreload> <link href=/_app/chunks/_examples_ssr-431754a5.js rel=modulepreload> <link href=/_app/chunks/ClevelandDotPlot.percent-range.html-323e5e0d.js rel=modulepreload> <link href=/_app/pages/example/_slug_.svelte-8372c866.js rel=modulepreload> <link href=/_app/chunks/cleanTitle-0cc73600.js rel=modulepreload> <link href=/_app/chunks/downloadBlob-f865e357.js rel=modulepreload> <link href=/_app/chunks/hljsDefineSvelte-bd0b92b8.js rel=modulepreload> <link href=/_app/assets/start-61d1577b.css rel=stylesheet> <link href=/_app/assets/pages/__layout.svelte-ee5e16f5.css rel=stylesheet> <link href=/_app/assets/GuideContents-1848e154.css rel=stylesheet> <link href=/_app/assets/_examples-998eb4dc.css rel=stylesheet> <link href=/_app/assets/Brush.html-f5d06c93.css rel=stylesheet> <link href=/_app/assets/dots-d212bdb6.css rel=stylesheet> <link href=/_app/assets/_examples_ssr-92b79465.css rel=stylesheet> <link href=/_app/assets/ClevelandDotPlot.percent-range.html-1e347309.css rel=stylesheet> <link href=/_app/assets/pages/example/_slug_.svelte-05adeb3d.css rel=stylesheet> <link href=/_app/assets/cleanTitle-6421f29e.css rel=stylesheet> <script type=module> import { start } from "/_app/start-101ba072.js";
			start({
				target: document.querySelector("body"),
				paths: {"base":"","assets":""},
				session: {},
				host: location.host,
				route: true,
				spa: false,
				trailing_slash: "never",
				hydrate: {
					status: 200,
					error: null,
					nodes: [
						import("/_app/pages/__layout.svelte-9e5a1370.js"),
						import("/_app/pages/example/_slug_.svelte-8372c866.js")
					],
					page: {
						host: location.host, // TODO this is redundant
						path: "\u002Fexample\u002FMultiLine",
						query: new URLSearchParams(""),
						params: {slug:"MultiLine"}
					}
				}
			}); </script> </head> <body> <div id=svelte> <div class="svelte-6iinyn closed mousecatcher"></div> <div class="svelte-6iinyn container"><span class="svelte-6iinyn menu-closed menu-link">Menu</span> <a class="svelte-6iinyn logo" href=/ sveltekit:prefetch>Layer Cake</a></div> <ul class="svelte-6iinyn dropdown"><li class=svelte-6iinyn> <select class=svelte-6iinyn><option value=/ >All<option value="" class="svelte-6iinyn header" disabled><option value=Client-side class="svelte-6iinyn header" disabled>Client-side<option value=/example/Bar>Bar<option value=/example/Beeswarm>Beeswarm<option value=/example/BeeswarmForce>Beeswarm, force layout<option value=/example/Brush>Brush<option value=/example/Calendar>Calendar<option value=/example/CirclePack>Circle pack<option value=/example/CirclePackForce>Circle pack, force layout<option value=/example/ClevelandDotPlot>Cleveland dot plot<option value=/example/Column>Column annotated<option value=/example/Histogram>Histogram<option value=/example/Line>Line + area<option value=/example/MapSvg>Map<option value=/example/MapLayered>Multilayer map<option value=/example/MultiLine>Multiline<option value=/example/CirclePackNested>Nested circle pack<option value=/example/Radar>Radar chart<option value=/example/Sankey>Sankey<option value=/example/Scatter>Scatter<option value=/example/SmallMultiples>Small multiples<option value=/example/AreaStacked>Stacked area<option value=/example/BarStacked>Stacked bar<option value=/example/ColumnStacked>Stacked column<option value=/example/SyncedBrush>Synced brush<option value=/example/Timeplot>Time of day plot<option value=/example/ScatterWebgl>WebGL Scatter<option value="" class="svelte-6iinyn header" disabled><option value=Server-side class="svelte-6iinyn header" disabled>Server-side<option value=/example-ssr/Bar>Bar<option value=/example-ssr/Brush>Brush<option value=/example-ssr/Calendar>Calendar<option value=/example-ssr/ClevelandDotPlot>Cleveland dot plot<option value=/example-ssr/Column>Column annotated<option value=/example-ssr/Histogram>Histogram<option value=/example-ssr/Line>Line + area<option value=/example-ssr/MapSvg>Map<option value=/example-ssr/MapLayered>Multilayer map<option value=/example-ssr/MultiLine>Multiline<option value=/example-ssr/Scatter>Scatter<option value=/example-ssr/SmallMultiples>Small multiples<option value=/example-ssr/AreaStacked>Stacked area<option value=/example-ssr/BarStacked>Stacked bar<option value=/example-ssr/ColumnStacked>Stacked column<option value=/example-ssr/SyncedBrush>Synced brush<option value=/example-ssr/Timeplot>Time of day plot<option value=/example-ssr/ScatterWebgl>WebGL Scatter</select></ul> <nav class="svelte-6iinyn closed"><ul class="svelte-6iinyn primary"><li class=svelte-6iinyn><a class=svelte-6iinyn href=/components sveltekit:prefetch><span class="svelte-6iinyn wide-name">Component gallery</span><span class="svelte-6iinyn short-name">Components</span></a></li> <li class=svelte-6iinyn><a class=svelte-6iinyn href=/guide sveltekit:prefetch>Guide</a></li> <li class=svelte-6iinyn><a class=svelte-6iinyn href=https://github.com/mhkeller/layercake id=github-link></a></ul> <div class="svelte-6iinyn secondary"><ul class="guide-toc svelte-7hddv0"></ul></div></nav> <main> <div class="svelte-m4suor main"><h1>Multiline (html labels + quadtree tooltip)<a class="svelte-m4suor edit-repl" href="https://svelte.dev/repl/cc8d7b6ace40433da8d694f2877258a8?version=3.17.3" rel=nofollow target=_blank>Edit</a></h1> <div class="svelte-m4suor chart-hero"><div class="chart-container svelte-xrhe6m"></div></div> <div class="svelte-m4suor download"><button class="icon svelte-1gef78k" style=background-image:url(/icons/download.svg) title="download zip file">Download      </button></div> <div class="svelte-m4suor dek"><p>A multiline example with a quadtree tooltip. This is an interesting example because the data exists in a few different structures:</p> <ol> <li>We're loading data from a "wide" format where each series has its own column name. We need to first turn this into...</li> <li>...a "long" format, where each type of fruit is grouped into its own array and each datapoint is a row. The column name becomes a property on the group whose name we define with the <code>zKey</code> variable.</li> <li>We also need a flat, ungrouped array of objects so that Layer Cake can measure the full data extents. This gets passed to the <code>flatData</code> prop so the scales know the full domain of the data.</li> </ol> </div> <div class="svelte-m4suor has-dek" id=pages><ul class=svelte-m4suor id=page-nav><li class="svelte-m4suor tab active">index.svelte<li class="svelte-m4suor tab">./components/MultiLine.svelte<li class="svelte-m4suor tab">./components/AxisX.svelte<li class="svelte-m4suor tab">./components/AxisY.svelte<li class="svelte-m4suor tab">./components/GroupLabels.html.svelte<li class="svelte-m4suor tab">./components/SharedTooltip.html.svelte<li class="svelte-m4suor tab">./components/QuadTree.html.svelte<li class="svelte-m4suor tab">./data/fruit.csv</ul> <div class=svelte-m4suor id=contents-container><div class="svelte-m4suor copy"></div> <div class=contents style=display:block><pre class=svelte-m4suor><span class=language-xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span></span><span class=language-javascript>
  <span class=hljs-keyword>import</span> { <span class="hljs-title class_">LayerCake</span>, <span class="hljs-title class_">Svg</span>, <span class="hljs-title class_">Html</span> } <span class=hljs-keyword>from</span> <span class=hljs-string>'layercake'</span>;
  <span class=hljs-keyword>import</span> { scaleOrdinal } <span class=hljs-keyword>from</span> <span class=hljs-string>'d3-scale'</span>;
  <span class=hljs-keyword>import</span> { timeParse, timeFormat } <span class=hljs-keyword>from</span> <span class=hljs-string>'d3-time-format'</span>;
  <span class=hljs-keyword>import</span> { format, precisionFixed } <span class=hljs-keyword>from</span> <span class=hljs-string>'d3-format'</span>;

  <span class=hljs-keyword>import</span> <span class="hljs-title class_">MultiLine</span> <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/MultiLine.svelte'</span>;
  <span class=hljs-keyword>import</span> <span class="hljs-title class_">Axis</span>X <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/AxisX.svelte'</span>;
  <span class=hljs-keyword>import</span> <span class="hljs-title class_">Axis</span>Y <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/AxisY.svelte'</span>;
  <span class=hljs-keyword>import</span> <span class="hljs-title class_">Labels</span> <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/GroupLabels.html.svelte'</span>;
  <span class=hljs-keyword>import</span> <span class="hljs-title class_">SharedTooltip</span> <span class=hljs-keyword>from</span> <span class=hljs-string>'./components/SharedTooltip.html.svelte'</span>;

  <span class=hljs-comment>// This example loads csv data as json using @rollup/plugin-dsv</span>
  <span class=hljs-keyword>import</span> data <span class=hljs-keyword>from</span> <span class=hljs-string>'./data/fruit.csv'</span>;

  <span class=hljs-comment>/* --------------------------------------------
   * Set what is our x key to separate it from the other series
   */</span>
  <span class=hljs-keyword>const</span> xKey = <span class=hljs-string>'month'</span>;
  <span class=hljs-keyword>const</span> yKey = <span class=hljs-string>'value'</span>;
  <span class=hljs-keyword>const</span> zKey = <span class=hljs-string>'fruit'</span>;

  <span class=hljs-keyword>const</span> seriesNames = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data[<span class=hljs-number>0</span>]).<span class="hljs-title function_">filter</span>(<span class=hljs-function><span class=hljs-params>d</span> =></span> d !== xKey);
  <span class=hljs-keyword>const</span> seriesColors = [<span class=hljs-string>'#ffe4b8'</span>, <span class=hljs-string>'#ffb3c0'</span>, <span class=hljs-string>'#ff7ac7'</span>, <span class=hljs-string>'#ff00cc'</span>];

  <span class=hljs-keyword>const</span> parseDate = <span class="hljs-title function_">timeParse</span>(<span class=hljs-string>'%Y-%m-%d'</span>);

  <span class=hljs-comment>/* --------------------------------------------
   * Create a "long" format that is a grouped series of data points
   * Layer Cake uses this data structure and the key names
   * set in xKey, yKey and zKey to map your data into each scale.
   */</span>
  <span class=hljs-keyword>const</span> dataLong = seriesNames.<span class="hljs-title function_">map</span>(<span class=hljs-function><span class=hljs-params>key</span> =></span> {
    <span class=hljs-keyword>return</span> {
      [zKey]: key,
      <span class=hljs-attr>values</span>: data.<span class="hljs-title function_">map</span>(<span class=hljs-function><span class=hljs-params>d</span> =></span> {
        d[xKey] = <span class=hljs-keyword>typeof</span> d[xKey] === <span class=hljs-string>'string'</span> ? <span class="hljs-title function_">parseDate</span>(d[xKey]) : d[xKey]; <span class=hljs-comment>// Conditional required for sapper</span>
        <span class=hljs-keyword>return</span> {
          [yKey]: +d[key],
          [xKey]: d[xKey]
        };
      })
    };
  });

  <span class=hljs-comment>/* --------------------------------------------
   * Make a flat array of the `values` of our nested series
   * we can pluck the field set from `yKey` from each item
   * in the array to measure the full extents
   */</span>
  <span class=hljs-keyword>const</span> <span class="hljs-title function_">flatten</span> = data => data.<span class="hljs-title function_">reduce</span>(<span class=hljs-function>(<span class=hljs-params>memo, group</span>) =></span> {
    <span class=hljs-keyword>return</span> memo.<span class="hljs-title function_">concat</span>(group.<span class=hljs-property>values</span>);
  }, []);

  <span class=hljs-keyword>const</span> formatTickX = <span class="hljs-title function_">timeFormat</span>(<span class=hljs-string>'%b. %e'</span>);
  <span class=hljs-keyword>const</span> <span class="hljs-title function_">formatTickY</span> = d => <span class="hljs-title function_">format</span>(<span class=hljs-string>`.<span class=hljs-subst>${precisionFixed(d)}</span>s`</span>)(d);
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span></span><span class=language-css>
  <span class=hljs-comment>/*
    The wrapper div needs to have an explicit width and height in CSS.
    It can also be a flexbox child or CSS grid element.
    The point being it needs dimensions since the &lt;LayerCake> element will
    expand to fill it.
  */</span>
  <span class=hljs-selector-class>.chart-container</span> {
    <span class=hljs-attribute>width</span>: <span class=hljs-number>100%</span>;
    <span class=hljs-attribute>height</span>: <span class=hljs-number>100%</span>;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"chart-container"</span>></span>
  <span class=hljs-tag>&lt;<span class=hljs-name>LayerCake</span>
    <span class=hljs-attr>padding</span>=</span></span><span class=language-javascript>{{ <span class=hljs-attr>top</span>: <span class=hljs-number>7</span>, <span class=hljs-attr>right</span>: <span class=hljs-number>10</span>, <span class=hljs-attr>bottom</span>: <span class=hljs-number>20</span>, <span class=hljs-attr>left</span>: <span class=hljs-number>25</span> }}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>x</span>=</span></span><span class=language-javascript>{xKey}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>y</span>=</span></span><span class=language-javascript>{yKey}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>z</span>=</span></span><span class=language-javascript>{zKey}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>yDomain</span>=</span></span><span class=language-javascript>{[<span class=hljs-number>0</span>, <span class=hljs-literal>null</span>]}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>zScale</span>=</span></span><span class=language-javascript>{<span class="hljs-title function_">scaleOrdinal</span>()}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>zDomain</span>=</span></span><span class=language-javascript>{seriesNames}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>zRange</span>=</span></span><span class=language-javascript>{seriesColors}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>flatData</span>=</span></span><span class=language-javascript>{<span class="hljs-title function_">flatten</span>(dataLong)}</span><span class=language-xml><span class=hljs-tag>
    <span class=hljs-attr>data</span>=</span></span><span class=language-javascript>{dataLong}</span><span class=language-xml><span class=hljs-tag>
  ></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>Svg</span>></span>
      <span class=hljs-tag>&lt;<span class=hljs-name>AxisX</span>
        <span class=hljs-attr>gridlines</span>=</span></span><span class=language-javascript>{<span class=hljs-literal>false</span>}</span><span class=language-xml><span class=hljs-tag>
        <span class=hljs-attr>ticks</span>=</span></span><span class=language-javascript>{data.<span class="hljs-title function_">map</span>(<span class=hljs-function><span class=hljs-params>d</span> =></span> d[xKey]).<span class="hljs-title function_">sort</span>(<span class=hljs-function>(<span class=hljs-params>a, b</span>) =></span> a - b)}</span><span class=language-xml><span class=hljs-tag>
        <span class=hljs-attr>formatTick</span>=</span></span><span class=language-javascript>{formatTickX}</span><span class=language-xml><span class=hljs-tag>
        <span class=hljs-attr>snapTicks</span>=</span></span><span class=language-javascript>{<span class=hljs-literal>true</span>}</span><span class=language-xml><span class=hljs-tag>
        <span class=hljs-attr>tickMarks</span>=</span></span><span class=language-javascript>{<span class=hljs-literal>true</span>}</span><span class=language-xml><span class=hljs-tag>
      /></span>
      <span class=hljs-tag>&lt;<span class=hljs-name>AxisY</span>
        <span class=hljs-attr>ticks</span>=</span></span><span class=language-javascript>{<span class=hljs-number>4</span>}</span><span class=language-xml><span class=hljs-tag>
        <span class=hljs-attr>formatTick</span>=</span></span><span class=language-javascript>{formatTickY}</span><span class=language-xml><span class=hljs-tag>
      /></span>
      <span class=hljs-tag>&lt;<span class=hljs-name>MultiLine</span>/></span>
    <span class=hljs-tag>&lt;/<span class=hljs-name>Svg</span>></span>

    <span class=hljs-tag>&lt;<span class=hljs-name>Html</span>></span>
      <span class=hljs-tag>&lt;<span class=hljs-name>Labels</span>/></span>
      <span class=hljs-tag>&lt;<span class=hljs-name>SharedTooltip</span>
        <span class=hljs-attr>formatTitle</span>=</span></span><span class=language-javascript>{formatTickX}</span><span class=language-xml><span class=hljs-tag>
        <span class=hljs-attr>dataset</span>=</span></span><span class=language-javascript>{data}</span><span class=language-xml><span class=hljs-tag>
      /></span>
    <span class=hljs-tag>&lt;/<span class=hljs-name>Html</span>></span>
  <span class=hljs-tag>&lt;/<span class=hljs-name>LayerCake</span>></span>
<span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span></span></pre> </div><div class=contents style=display:none><pre class=svelte-m4suor><span class=language-xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span></span><span class=language-javascript>
  <span class=hljs-comment>/**
    Generates an SVG multi-series line chart. It expects your data to be an array of objects, each with a `values` key that is an array of data objects.
  */</span>
  <span class=hljs-keyword>import</span> { getContext } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;

  <span class=hljs-keyword>const</span> { data, xGet, yGet, zGet } = <span class="hljs-title function_">getContext</span>(<span class=hljs-string>'LayerCake'</span>);
</span><span class=hljs-keyword>
  $: </span><span class=language-javascript>path = <span class=hljs-function><span class=hljs-params>values</span> =></span> {
    <span class=hljs-keyword>return</span> <span class=hljs-string>'M'</span> + values
      .<span class="hljs-title function_">map</span>(<span class=hljs-function><span class=hljs-params>d</span> =></span> {
        <span class=hljs-keyword>return</span> $xGet(d) + <span class=hljs-string>','</span> + $yGet(d);
      })
      .<span class="hljs-title function_">join</span>(<span class=hljs-string>'L'</span>);
  };
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"line-group"</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>#each</span><span class=language-javascript> $data <span class=hljs-keyword>as</span> group}</span><span class=language-xml>
    <span class=hljs-tag>&lt;<span class=hljs-name>path</span>
      <span class=hljs-attr>class</span>=<span class=hljs-string>'path-line'</span>
      <span class=hljs-attr>d</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{<span class="hljs-title function_">path</span>(group.<span class=hljs-property>values</span>)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>
      <span class=hljs-attr>stroke</span>=<span class=hljs-string>"</span></span></span><span class=language-javascript>{$zGet(group)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>"</span>
    ></span><span class=hljs-tag>&lt;/<span class=hljs-name>path</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>/each</span><span class=language-javascript>}</span><span class=language-xml>
<span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span></span><span class=language-css>
  <span class=hljs-selector-class>.path-line</span> {
    fill: none;
    stroke-linejoin: round;
    stroke-linecap: round;
    stroke-<span class=hljs-attribute>width</span>: <span class=hljs-number>3px</span>;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span></span></pre> </div><div class=contents style=display:none><pre class=svelte-m4suor><span class=language-xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span></span><span class=language-javascript>
  <span class=hljs-comment>/**
    Generates an SVG x-axis. This component is also configured to detect if your x-scale is an ordinal scale. If so, it will place the markers in the middle of the bandwidth.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Boolean</span>} [gridlines=true] – Extend lines from the ticks into the chart space
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Boolean</span>} [tickMarks=false] – Show a vertical mark for each tick.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Boolean</span>} [baseline=false] – Show a solid line at the bottom.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Boolean</span>} [snapTicks=false] – Instead of centering the text on the first and the last items, align them to the edges of the chart.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Function</span>} [formatTick=d => d] – A function that passes the current tick value and expects a nicely formatted value in return.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number|Array|Function</span>} [ticks] – If this is a number, it passes that along to the [d3Scale.ticks](https://github.com/d3/d3-scale) function. If this is an array, hardcodes the ticks to those values. If it's a function, passes along the default tick values and expects an array of tick values in return. If nothing, it uses the default ticks supplied by the D3 function.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number</span>} [xTick=0] – TK
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number</span>} [yTick=16] – The distance from the baseline to place each tick value.
  */</span>
  <span class=hljs-keyword>import</span> { getContext } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;

  <span class=hljs-keyword>const</span> { width, height, xScale, yRange } = <span class="hljs-title function_">getContext</span>(<span class=hljs-string>'LayerCake'</span>);

  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> gridlines = <span class=hljs-literal>true</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> tickMarks = <span class=hljs-literal>false</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> baseline = <span class=hljs-literal>false</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> snapTicks = <span class=hljs-literal>false</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> <span class="hljs-title function_">formatTick</span> = d => d;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> ticks = <span class=hljs-literal>undefined</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> xTick = <span class=hljs-number>0</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> yTick = <span class=hljs-number>16</span>;
</span><span class=hljs-keyword>
  $: </span><span class=language-javascript>isBandwidth = <span class=hljs-keyword>typeof</span> $xScale.<span class=hljs-property>bandwidth</span> === <span class=hljs-string>'function'</span>;
</span><span class=hljs-keyword>
  $: </span><span class=language-javascript>tickVals = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(ticks) ? ticks :
    isBandwidth ?
      $xScale.<span class="hljs-title function_">domain</span>() :
      <span class=hljs-keyword>typeof</span> ticks === <span class=hljs-string>'function'</span> ?
        <span class="hljs-title function_">ticks</span>($xScale.<span class="hljs-title function_">ticks</span>()) :
          $xScale.<span class="hljs-title function_">ticks</span>(ticks);

  <span class=hljs-keyword>function</span> <span class="hljs-title function_">textAnchor</span>(<span class=hljs-params>i</span>) {
    <span class=hljs-keyword>if</span> (snapTicks === <span class=hljs-literal>true</span>) {
      <span class=hljs-keyword>if</span> (i === <span class=hljs-number>0</span>) {
        <span class=hljs-keyword>return</span> <span class=hljs-string>'start'</span>;
      }
      <span class=hljs-keyword>if</span> (i === tickVals.<span class=hljs-property>length</span> - <span class=hljs-number>1</span>) {
        <span class=hljs-keyword>return</span> <span class=hljs-string>'end'</span>;
      }
    }
    <span class=hljs-keyword>return</span> <span class=hljs-string>'middle'</span>;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'axis x-axis'</span> <span class=hljs-attr>class:snapTicks</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>#each</span><span class=language-javascript> tickVals <span class=hljs-keyword>as</span> tick, i}</span><span class=language-xml>
    <span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'tick tick-</span></span></span><span class=language-javascript>{ i }</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>transform</span>=<span class=hljs-string>'translate(</span></span></span><span class=language-javascript>{$xScale(tick)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>,</span></span></span><span class=language-javascript>{$yRange[<span class=hljs-number>0</span>]}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>)'</span>></span>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>#if</span><span class=language-javascript> gridlines !== <span class=hljs-literal>false</span>}</span><span class=language-xml>
        <span class=hljs-tag>&lt;<span class=hljs-name>line</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"gridline"</span> <span class=hljs-attr>y1</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{$height * -<span class=hljs-number>1</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>y2</span>=<span class=hljs-string>'0'</span> <span class=hljs-attr>x1</span>=<span class=hljs-string>'0'</span> <span class=hljs-attr>x2</span>=<span class=hljs-string>'0'</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>line</span>></span>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>/if</span><span class=language-javascript>}</span><span class=language-xml>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>#if</span><span class=language-javascript> tickMarks === <span class=hljs-literal>true</span>}</span><span class=language-xml>
        <span class=hljs-tag>&lt;<span class=hljs-name>line</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"tick-mark"</span> <span class=hljs-attr>y1</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{<span class=hljs-number>0</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>y2</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{<span class=hljs-number>6</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>x1</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{xTick || isBandwidth ? $xScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span> : <span class=hljs-number>0</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>x2</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{xTick || isBandwidth ? $xScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span> : <span class=hljs-number>0</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>line</span>></span>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>/if</span><span class=language-javascript>}</span><span class=language-xml>
      <span class=hljs-tag>&lt;<span class=hljs-name>text</span>
        <span class=hljs-attr>x</span>=<span class=hljs-string>"</span></span></span><span class=language-javascript>{xTick || isBandwidth ? $xScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span> : <span class=hljs-number>0</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>"</span>
        <span class=hljs-attr>y</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{yTick}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>
        <span class=hljs-attr>dx</span>=<span class=hljs-string>''</span>
        <span class=hljs-attr>dy</span>=<span class=hljs-string>''</span>
        <span class=hljs-attr>text-anchor</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{<span class="hljs-title function_">textAnchor</span>(i)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>></span></span><span class=language-javascript>{<span class="hljs-title function_">formatTick</span>(tick)}</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>text</span>></span>
    <span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>/each</span><span class=language-javascript>}</span><span class=language-xml>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>#if</span><span class=language-javascript> baseline === <span class=hljs-literal>true</span>}</span><span class=language-xml>
    <span class=hljs-tag>&lt;<span class=hljs-name>line</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"baseline"</span> <span class=hljs-attr>y1</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{$height + <span class=hljs-number>0.5</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>y2</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{$height + <span class=hljs-number>0.5</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>x1</span>=<span class=hljs-string>'0'</span> <span class=hljs-attr>x2</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{$width}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>line</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>/if</span><span class=language-javascript>}</span><span class=language-xml>
<span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span></span><span class=language-css>
  <span class=hljs-selector-class>.tick</span> {
    <span class=hljs-attribute>font-size</span>: .<span class=hljs-number>725em</span>;
    <span class=hljs-attribute>font-weight</span>: <span class=hljs-number>200</span>;
  }

  line,
  <span class=hljs-selector-class>.tick</span> line {
    stroke: <span class=hljs-number>#aaa</span>;
    stroke-dasharray: <span class=hljs-number>2</span>;
  }

  <span class=hljs-selector-class>.tick</span> text {
    fill: <span class=hljs-number>#666</span>;
  }

  <span class=hljs-selector-class>.tick</span> <span class=hljs-selector-class>.tick-mark</span>,
  <span class=hljs-selector-class>.baseline</span> {
    stroke-dasharray: <span class=hljs-number>0</span>;
  }
  <span class=hljs-comment>/* This looks slightly better */</span>
  <span class=hljs-selector-class>.axis</span><span class=hljs-selector-class>.snapTicks</span> <span class=hljs-selector-class>.tick</span><span class=hljs-selector-pseudo>:last-child</span> text {
    <span class=hljs-attribute>transform</span>: <span class=hljs-built_in>translateX</span>(<span class=hljs-number>3px</span>);
  }
  <span class=hljs-selector-class>.axis</span><span class=hljs-selector-class>.snapTicks</span> <span class=hljs-selector-class>.tick</span><span class=hljs-selector-class>.tick-0</span> text {
    <span class=hljs-attribute>transform</span>: <span class=hljs-built_in>translateX</span>(-<span class=hljs-number>3px</span>);
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span></span></pre> </div><div class=contents style=display:none><pre class=svelte-m4suor><span class=language-xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span></span><span class=language-javascript>
  <span class=hljs-comment>/**
    Generates an HTML y-axis.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Boolean</span>} [gridlines=true] – Extend lines from the ticks into the chart space
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Boolean</span>} [tickMarks=false] – Show a vertical mark for each tick.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Function</span>} [formatTick=d => d] – A function that passes the current tick value and expects a nicely formatted value in return.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number|Array|Function</span>} [ticks=4] – If this is a number, it passes that along to the [d3Scale.ticks](https://github.com/d3/d3-scale) function. If this is an array, hardcodes the ticks to those values. If it's a function, passes along the default tick values and expects an array of tick values in return.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number</span>} [xTick=0] – How far over to position the text marker.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number</span>} [dxTick=0] – Any optional value passed to the `dx` attribute on the text marker and tick mark (if visible). This is ignored on the text marker if your scale is ordinal.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number</span>} [yTick=0] – How far up and down to position the text marker.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number</span>} [dyTick=0] – Any optional value passed to the `dy` attribute on the text marker and tick mark (if visible). This is ignored on the text marker if your scale is ordinal.
  */</span>
  <span class=hljs-keyword>import</span> { getContext } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;

  <span class=hljs-keyword>const</span> { padding, xRange, yScale } = <span class="hljs-title function_">getContext</span>(<span class=hljs-string>'LayerCake'</span>);

  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> gridlines = <span class=hljs-literal>true</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> tickMarks = <span class=hljs-literal>false</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> <span class="hljs-title function_">formatTick</span> = d => d;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> ticks = <span class=hljs-number>4</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> xTick = <span class=hljs-number>0</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> yTick = <span class=hljs-number>0</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> dxTick = <span class=hljs-number>0</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> dyTick = -<span class=hljs-number>4</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> textAnchor = <span class=hljs-string>'start'</span>;
</span><span class=hljs-keyword>
  $: </span><span class=language-javascript>isBandwidth = <span class=hljs-keyword>typeof</span> $yScale.<span class=hljs-property>bandwidth</span> === <span class=hljs-string>'function'</span>;
</span><span class=hljs-keyword>
  $: </span><span class=language-javascript>tickVals = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(ticks) ? ticks :
    isBandwidth ?
      $yScale.<span class="hljs-title function_">domain</span>() :
      <span class=hljs-keyword>typeof</span> ticks === <span class=hljs-string>'function'</span> ?
        <span class="hljs-title function_">ticks</span>($yScale.<span class="hljs-title function_">ticks</span>()) :
          $yScale.<span class="hljs-title function_">ticks</span>(ticks);
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'axis y-axis'</span> <span class=hljs-attr>transform</span>=<span class=hljs-string>'translate(</span></span></span><span class=language-javascript>{-$padding.<span class=hljs-property>left</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>, 0)'</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>#each</span><span class=language-javascript> tickVals <span class=hljs-keyword>as</span> tick}</span><span class=language-xml>
    <span class=hljs-tag>&lt;<span class=hljs-name>g</span> <span class=hljs-attr>class</span>=<span class=hljs-string>'tick tick-</span></span></span><span class=language-javascript>{tick}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span> <span class=hljs-attr>transform</span>=<span class=hljs-string>'translate(</span></span></span><span class=language-javascript>{$xRange[<span class=hljs-number>0</span>] + (isBandwidth ? $padding.<span class=hljs-property>left</span> : <span class=hljs-number>0</span>)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>, </span></span></span><span class=language-javascript>{$yScale(tick)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>)'</span>></span>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>#if</span><span class=language-javascript> gridlines !== <span class=hljs-literal>false</span>}</span><span class=language-xml>
        <span class=hljs-tag>&lt;<span class=hljs-name>line</span>
          <span class=hljs-attr>class</span>=<span class=hljs-string>"gridline"</span>
          <span class=hljs-attr>x2</span>=<span class=hljs-string>'100%'</span>
          <span class=hljs-attr>y1</span>=</span></span><span class=language-javascript>{yTick + (isBandwidth ? ($yScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span>) : <span class=hljs-number>0</span>)}</span><span class=language-xml><span class=hljs-tag>
          <span class=hljs-attr>y2</span>=</span></span><span class=language-javascript>{yTick + (isBandwidth ? ($yScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span>) : <span class=hljs-number>0</span>)}</span><span class=language-xml><span class=hljs-tag>
        ></span><span class=hljs-tag>&lt;/<span class=hljs-name>line</span>></span>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>/if</span><span class=language-javascript>}</span><span class=language-xml>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>#if</span><span class=language-javascript> tickMarks === <span class=hljs-literal>true</span>}</span><span class=language-xml>
        <span class=hljs-tag>&lt;<span class=hljs-name>line</span>
          <span class=hljs-attr>class</span>=<span class=hljs-string>'tick-mark'</span>
          <span class=hljs-attr>x1</span>=<span class=hljs-string>'0'</span>
          <span class=hljs-attr>x2</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{isBandwidth ? -<span class=hljs-number>6</span> : <span class=hljs-number>6</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>
          <span class=hljs-attr>y1</span>=</span></span><span class=language-javascript>{yTick + (isBandwidth ? ($yScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span>) : <span class=hljs-number>0</span>)}</span><span class=language-xml><span class=hljs-tag>
          <span class=hljs-attr>y2</span>=</span></span><span class=language-javascript>{yTick + (isBandwidth ? ($yScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span>) : <span class=hljs-number>0</span>)}</span><span class=language-xml><span class=hljs-tag>
        ></span><span class=hljs-tag>&lt;/<span class=hljs-name>line</span>></span>
      </span><span class=language-javascript>{</span><span class=hljs-keyword>/if</span><span class=language-javascript>}</span><span class=language-xml>
      <span class=hljs-tag>&lt;<span class=hljs-name>text</span>
        <span class=hljs-attr>x</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{xTick}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>
        <span class=hljs-attr>y</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{yTick + (isBandwidth ? $yScale.<span class="hljs-title function_">bandwidth</span>() / <span class=hljs-number>2</span> : <span class=hljs-number>0</span>)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>
        <span class=hljs-attr>dx</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{isBandwidth ? -<span class=hljs-number>9</span> : dxTick}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>
        <span class=hljs-attr>dy</span>=<span class=hljs-string>'</span></span></span><span class=language-javascript>{isBandwidth ? <span class=hljs-number>4</span> : dyTick}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>'</span>
        <span class=hljs-attr>style</span>=<span class=hljs-string>"text-anchor:</span></span></span><span class=language-javascript>{isBandwidth ? <span class=hljs-string>'end'</span> : textAnchor}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>;"</span>
      ></span></span><span class=language-javascript>{<span class="hljs-title function_">formatTick</span>(tick)}</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>text</span>></span>
    <span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>/each</span><span class=language-javascript>}</span><span class=language-xml>
<span class=hljs-tag>&lt;/<span class=hljs-name>g</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span></span><span class=language-css>
  <span class=hljs-selector-class>.tick</span> {
    <span class=hljs-attribute>font-size</span>: .<span class=hljs-number>725em</span>;
    <span class=hljs-attribute>font-weight</span>: <span class=hljs-number>200</span>;
  }

  <span class=hljs-selector-class>.tick</span> line {
    stroke: <span class=hljs-number>#aaa</span>;
  }
  <span class=hljs-selector-class>.tick</span> <span class=hljs-selector-class>.gridline</span> {
    stroke-dasharray: <span class=hljs-number>2</span>;
  }

  <span class=hljs-selector-class>.tick</span> text {
    fill: <span class=hljs-number>#666</span>;
  }

  <span class=hljs-selector-class>.tick</span><span class=hljs-selector-class>.tick-0</span> line {
    stroke-dasharray: <span class=hljs-number>0</span>;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span></span></pre> </div><div class=contents style=display:none><pre class=svelte-m4suor><span class=language-xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span></span><span class=language-javascript>
  <span class=hljs-comment>/**
    Generates HTML text labels for a nested data structure. It places the label near the y-value of the highest x-valued data point. This is useful for labeling the final point in a multi-series line chart, for example. It expects your data to be an array of objects where each has `values` field that is an array of data objects. It uses the `z` field accessor to pull the text label.
  */</span>
  <span class=hljs-keyword>import</span> { getContext } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;
  <span class=hljs-keyword>import</span> { max } <span class=hljs-keyword>from</span> <span class=hljs-string>'d3-array'</span>;

  <span class=hljs-keyword>const</span> { data, x, y, xScale, yScale, xRange, yRange, z } = <span class="hljs-title function_">getContext</span>(<span class=hljs-string>'LayerCake'</span>);

  <span class=hljs-comment>/* --------------------------------------------
   * Title case the first letter
   */</span>
  <span class=hljs-keyword>const</span> <span class="hljs-title function_">cap</span> = val => val.<span class="hljs-title function_">replace</span>(<span class=hljs-regexp>/^\w/</span>, <span class=hljs-function><span class=hljs-params>d</span> =></span> d.<span class="hljs-title function_">toUpperCase</span>());

  <span class=hljs-comment>/* --------------------------------------------
   * Put the label on the highest value
   */</span>
</span><span class=hljs-keyword>  $: </span><span class=language-javascript>left = <span class=hljs-function><span class=hljs-params>values</span> =></span> $xScale(<span class="hljs-title function_">max</span>(values, $x)) /  <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...$xRange);
</span><span class=hljs-keyword>  $: </span><span class=language-javascript>top = <span class=hljs-function><span class=hljs-params>values</span> =></span> $yScale(<span class="hljs-title function_">max</span>(values, $y)) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...$yRange);
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

</span><span class=language-javascript>{</span><span class=hljs-keyword>#each</span><span class=language-javascript> $data <span class=hljs-keyword>as</span> group}</span><span class=language-xml>
  <span class=hljs-tag>&lt;<span class=hljs-name>div</span>
    <span class=hljs-attr>class</span>=<span class=hljs-string>"label"</span>
    <span class=hljs-attr>style</span>=<span class=hljs-string>"
      top:</span></span></span><span class=language-javascript>{<span class="hljs-title function_">top</span>(group.<span class=hljs-property>values</span>) * <span class=hljs-number>100</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>%;
      left:</span></span></span><span class=language-javascript>{<span class="hljs-title function_">left</span>(group.<span class=hljs-property>values</span>) * <span class=hljs-number>100</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>%;
    "</span>
  ></span></span><span class=language-javascript>{<span class="hljs-title function_">cap</span>($z(group))}</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
</span><span class=language-javascript>{</span><span class=hljs-keyword>/each</span><span class=language-javascript>}</span><span class=language-xml>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span></span><span class=language-css>
  <span class=hljs-selector-class>.label</span> {
    <span class=hljs-attribute>position</span>: absolute;
    <span class=hljs-attribute>transform</span>: <span class=hljs-built_in>translate</span>(-<span class=hljs-number>100%</span>, -<span class=hljs-number>100%</span>)<span class=hljs-built_in>translateY</span>(<span class=hljs-number>1px</span>);
    <span class=hljs-attribute>font-size</span>: <span class=hljs-number>13px</span>;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span></span></pre> </div><div class=contents style=display:none><pre class=svelte-m4suor><span class=language-xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span></span><span class=language-javascript>
  <span class=hljs-comment>/**
    Generates a tooltip that works on multiseries datasets, like multiline charts. It creates a tooltip showing the name of the series and the current value. It finds the nearest data point using the [QuadTree.html.svelte](https://layercake.graphics/components/QuadTree.html.svelte) component.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Function</span>} [formatTitle=d => d] – A function to format the tooltip title, which is `$config.x`.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Function</span>} [formatKey=d => titleCase(d)] – A function to format the series name.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Function</span>} [formatValue=d => isNaN(+d) ? d : commas(d)] – A function to format the value.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Array</span>} [dataset=$data] – The dataset to work off of. You can pass something custom in here in case you don't want to use the main data or it's in a strange format.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Number</span>} [offset=20] – A negative y-offset from the hover point, in pixels.
    */</span>
  <span class=hljs-keyword>import</span> { getContext } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;
  <span class=hljs-keyword>import</span> { format } <span class=hljs-keyword>from</span> <span class=hljs-string>'d3-format'</span>;

  <span class=hljs-keyword>import</span> <span class="hljs-title class_">QuadTree</span> <span class=hljs-keyword>from</span> <span class=hljs-string>'./QuadTree.html.svelte'</span>;

  <span class=hljs-keyword>const</span> { data, width, yScale, config } = <span class="hljs-title function_">getContext</span>(<span class=hljs-string>'LayerCake'</span>);

  <span class=hljs-keyword>const</span> commas = <span class="hljs-title function_">format</span>(<span class=hljs-string>','</span>);
  <span class=hljs-keyword>const</span> <span class="hljs-title function_">titleCase</span> = d => d.<span class="hljs-title function_">replace</span>(<span class=hljs-regexp>/^\w/</span>, <span class=hljs-function><span class=hljs-params>w</span> =></span> w.<span class="hljs-title function_">toUpperCase</span>());

  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> offset = <span class=hljs-number>20</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> dataset = $data;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> <span class="hljs-title function_">formatTitle</span> = d => d;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> <span class="hljs-title function_">formatKey</span> = d => <span class="hljs-title function_">titleCase</span>(d);
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> <span class="hljs-title function_">formatValue</span> = d => <span class=hljs-built_in>isNaN</span>(+d) ? d : <span class="hljs-title function_">commas</span>(d);

  <span class=hljs-keyword>const</span> w = <span class=hljs-number>150</span>;
  <span class=hljs-keyword>const</span> w2 = w / <span class=hljs-number>2</span>;

  <span class=hljs-comment>/* --------------------------------------------
   * Sort the keys by the highest value
   */</span>
  <span class=hljs-keyword>function</span> <span class="hljs-title function_">sortResult</span>(<span class=hljs-params>result</span>) {
    <span class=hljs-keyword>if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(result).<span class=hljs-property>length</span> === <span class=hljs-number>0</span>) <span class=hljs-keyword>return</span> [];
    <span class=hljs-keyword>const</span> rows = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(result).<span class="hljs-title function_">filter</span>(<span class=hljs-function><span class=hljs-params>d</span> =></span> d !== $config.<span class=hljs-property>x</span>).<span class="hljs-title function_">map</span>(<span class=hljs-function><span class=hljs-params>key</span> =></span> {
      <span class=hljs-keyword>return</span> {
        key,
        <span class=hljs-attr>value</span>: result[key]
      };
    }).<span class="hljs-title function_">sort</span>(<span class=hljs-function>(<span class=hljs-params>a, b</span>) =></span> b.<span class=hljs-property>value</span> - a.<span class=hljs-property>value</span>);

    <span class=hljs-keyword>return</span> rows;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span></span><span class=language-css>
  <span class=hljs-selector-class>.tooltip</span> {
    <span class=hljs-attribute>position</span>: absolute;
    <span class=hljs-attribute>font-size</span>: <span class=hljs-number>13px</span>;
    <span class=hljs-attribute>pointer-events</span>: none;
    <span class=hljs-attribute>border</span>: <span class=hljs-number>1px</span> solid <span class=hljs-number>#ccc</span>;
    <span class=hljs-attribute>background</span>: <span class=hljs-built_in>rgba</span>(<span class=hljs-number>255</span>, <span class=hljs-number>255</span>, <span class=hljs-number>255</span>, <span class=hljs-number>0.85</span>);
    <span class=hljs-attribute>transform</span>: <span class=hljs-built_in>translate</span>(-<span class=hljs-number>50%</span>, -<span class=hljs-number>100%</span>);
    <span class=hljs-attribute>padding</span>: <span class=hljs-number>5px</span>;
    <span class=hljs-attribute>z-index</span>: <span class=hljs-number>15</span>;
    <span class=hljs-attribute>pointer-events</span>: none;
  }
  <span class=hljs-selector-class>.line</span> {
    <span class=hljs-attribute>position</span>: absolute;
    <span class=hljs-attribute>top</span>: <span class=hljs-number>0</span>;
    <span class=hljs-attribute>bottom</span>: <span class=hljs-number>0</span>;
    <span class=hljs-attribute>width</span>: <span class=hljs-number>1px</span>;
    <span class=hljs-attribute>border-left</span>: <span class=hljs-number>1px</span> dotted <span class=hljs-number>#666</span>;
    <span class=hljs-attribute>pointer-events</span>: none;
  }
  <span class=hljs-selector-class>.tooltip</span>,
  <span class=hljs-selector-class>.line</span> {
    <span class=hljs-attribute>transition</span>: left <span class=hljs-number>250ms</span> ease-out, top <span class=hljs-number>250ms</span> ease-out;
  }
  <span class=hljs-selector-class>.title</span> {
    <span class=hljs-attribute>font-weight</span>: bold;
  }
  <span class=hljs-selector-class>.key</span> {
    <span class=hljs-attribute>color</span>: <span class=hljs-number>#999</span>;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>QuadTree</span>
  <span class=hljs-attr>dataset</span>=</span></span><span class=language-javascript>{dataset}</span><span class=language-xml><span class=hljs-tag>
  <span class=hljs-attr>y</span>=<span class=hljs-string>'x'</span>
  <span class=hljs-attr>let:x</span>
  <span class=hljs-attr>let:y</span>
  <span class=hljs-attr>let:visible</span>
  <span class=hljs-attr>let:found</span>
  <span class=hljs-attr>let:e</span>
></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>#if</span><span class=language-javascript> visible === <span class=hljs-literal>true</span>}</span><span class=language-xml>
    <span class=hljs-tag>&lt;<span class=hljs-name>div</span>
      <span class=hljs-attr>style</span>=<span class=hljs-string>"left:</span></span></span><span class=language-javascript>{x}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>px;"</span>
      <span class=hljs-attr>class</span>=<span class=hljs-string>"line"</span>></span><span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
    <span class=hljs-tag>&lt;<span class=hljs-name>div</span>
      <span class=hljs-attr>class</span>=<span class=hljs-string>"tooltip"</span>
      <span class=hljs-attr>style</span>=<span class=hljs-string>"
        width:</span></span></span><span class=language-javascript>{w}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>px;
        display: </span></span></span><span class=language-javascript>{ visible ? <span class=hljs-string>'block'</span> : <span class=hljs-string>'none'</span> }</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>;
        top:</span></span></span><span class=language-javascript>{$yScale(<span class="hljs-title function_">sortResult</span>(found)[<span class=hljs-number>0</span>].<span class=hljs-property>value</span>) - offset}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>px;
        left:</span></span></span><span class=language-javascript>{<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(w2, x), $width - w2)}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>px;"</span>
      ></span>
        <span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"title"</span>></span></span><span class=language-javascript>{<span class="hljs-title function_">formatTitle</span>(found[$config.<span class=hljs-property>x</span>])}</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
        </span><span class=language-javascript>{</span><span class=hljs-keyword>#each</span><span class=language-javascript> <span class="hljs-title function_">sortResult</span>(found) <span class=hljs-keyword>as</span> row}</span><span class=language-xml>
          <span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"row"</span>></span><span class=hljs-tag>&lt;<span class=hljs-name>span</span> <span class=hljs-attr>class</span>=<span class=hljs-string>"key"</span>></span></span><span class=language-javascript>{<span class="hljs-title function_">formatKey</span>(row.<span class=hljs-property>key</span>)}</span><span class=language-xml>:<span class=hljs-tag>&lt;/<span class=hljs-name>span</span>></span> </span><span class=language-javascript>{<span class="hljs-title function_">formatValue</span>(row.<span class=hljs-property>value</span>)}</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
        </span><span class=language-javascript>{</span><span class=hljs-keyword>/each</span><span class=language-javascript>}</span><span class=language-xml>
    <span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
  </span><span class=language-javascript>{</span><span class=hljs-keyword>/if</span><span class=language-javascript>}</span><span class=language-xml>
<span class=hljs-tag>&lt;/<span class=hljs-name>QuadTree</span>></span></span></pre> </div><div class=contents style=display:none><pre class=svelte-m4suor><span class=language-xml><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span></span><span class=language-javascript>
  <span class=hljs-comment>/**
    Creates an interaction layer (in HTML) using [d3-quadtree](https://github.com/d3/d3-quadtree) to find the nearest datapoint to the mouse. This component creates a slot that exposes variables `x`, `y`, `found` (the found datapoint), `visible` (a Boolean whether any data was found) and `e` (the event object).

    The quadtree searches across both the x and y dimensions at the same time. But if you want to only search across one, set the `x` and `y` props to the same value. For example, the [shared tooltip component](https://layercake.graphics/components/SharedTooltip.html.svelte) sets `y='x'` since it's nicer behavior to only pick up on the nearest x-value.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>String</span>} [searchRadius=undefined] – The number of pixels to search around the mouse's location. This is the third argument passed to [`quadtree.find`](https://github.com/d3/d3-quadtree#quadtree_find) and by default a value of `undefined` means an unlimited range.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>String</span>} [x='x'] – The dimension to search across when moving the mouse left and right.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>String</span>} [y='y'] – The dimension to search across when moving the mouse up and down.
    <span class=hljs-doctag>@type</span> {<span class=hljs-type>Array</span>} [dataset=$data] – The dataset to work off of. You can pass something custom in here in case you don't want to use the main data or it's in a strange format.
  */</span>
  <span class=hljs-keyword>import</span> { getContext } <span class=hljs-keyword>from</span> <span class=hljs-string>'svelte'</span>;
  <span class=hljs-keyword>import</span> { quadtree } <span class=hljs-keyword>from</span> <span class=hljs-string>'d3-quadtree'</span>;

  <span class=hljs-keyword>const</span> { data, xGet, yGet, width, height } = <span class="hljs-title function_">getContext</span>(<span class=hljs-string>'LayerCake'</span>);

  <span class=hljs-keyword>let</span> visible = <span class=hljs-literal>false</span>;
  <span class=hljs-keyword>let</span> found = {};
  <span class=hljs-keyword>let</span> e = {};

  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> dataset = <span class=hljs-literal>undefined</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> x = <span class=hljs-string>'x'</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> y = <span class=hljs-string>'y'</span>;
  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> searchRadius = <span class=hljs-literal>undefined</span>;
</span><span class=hljs-keyword>
  $: </span><span class=language-javascript>xGetter = x === <span class=hljs-string>'x'</span> ? $xGet : $yGet;
</span><span class=hljs-keyword>  $: </span><span class=language-javascript>yGetter = y === <span class=hljs-string>'y'</span> ? $yGet : $xGet;

  <span class=hljs-keyword>function</span> <span class="hljs-title function_">findItem</span> (evt) {
    e = evt;

    <span class=hljs-keyword>const</span> xLayerKey = <span class=hljs-string>`layer<span class=hljs-subst>${x.toUpperCase()}</span>`</span>;
    <span class=hljs-keyword>const</span> yLayerKey = <span class=hljs-string>`layer<span class=hljs-subst>${y.toUpperCase()}</span>`</span>;

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class=hljs-string>'evt'</span>, evt[xLayerKey], evt[yLayerKey]);

    found = finder.<span class="hljs-title function_">find</span>(evt[xLayerKey], evt[yLayerKey], searchRadius) || {};
    visible = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(found).<span class=hljs-property>length</span> > <span class=hljs-number>0</span>;
  }
</span><span class=hljs-keyword>
  $: </span><span class=language-javascript>finder = <span class="hljs-title function_">quadtree</span>()
    .<span class="hljs-title function_">extent</span>([[-<span class=hljs-number>1</span>, -<span class=hljs-number>1</span>], [$width + <span class=hljs-number>1</span>, $height + <span class=hljs-number>1</span>]])
    .<span class="hljs-title function_">x</span>(xGetter)
    .<span class="hljs-title function_">y</span>(yGetter)
    .<span class="hljs-title function_">addAll</span>(dataset || $data);
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>style</span>></span></span><span class=language-css>
  <span class=hljs-selector-class>.bg</span> {
    <span class=hljs-attribute>position</span>: absolute;
    <span class=hljs-attribute>top</span>: <span class=hljs-number>0</span>;
    <span class=hljs-attribute>right</span>: <span class=hljs-number>0</span>;
    <span class=hljs-attribute>bottom</span>: <span class=hljs-number>0</span>;
    <span class=hljs-attribute>left</span>: <span class=hljs-number>0</span>;
  }
</span><span class=language-xml><span class=hljs-tag>&lt;/<span class=hljs-name>style</span>></span>

<span class=hljs-tag>&lt;<span class=hljs-name>div</span>
  <span class=hljs-attr>class</span>=<span class=hljs-string>"bg"</span>
  <span class=hljs-attr>on:mousemove</span>=<span class=hljs-string>"</span></span></span><span class=language-javascript>{findItem}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>"</span>
  <span class=hljs-attr>on:mouseout</span>=<span class=hljs-string>"</span></span></span><span class=language-javascript>{<span class=hljs-function>() =></span> visible = <span class=hljs-literal>false</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>"</span>
  <span class=hljs-attr>on:blur</span>=<span class=hljs-string>"</span></span></span><span class=language-javascript>{<span class=hljs-function>() =></span> visible = <span class=hljs-literal>false</span>}</span><span class=language-xml><span class=hljs-tag><span class=hljs-string>"</span>
></span><span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
<span class=hljs-tag>&lt;<span class=hljs-name>slot</span>
  <span class=hljs-attr>x</span>=</span></span><span class=language-javascript>{<span class="hljs-title function_">xGetter</span>(found) || <span class=hljs-number>0</span>}</span><span class=language-xml><span class=hljs-tag>
  <span class=hljs-attr>y</span>=</span></span><span class=language-javascript>{<span class="hljs-title function_">yGetter</span>(found) || <span class=hljs-number>0</span>}</span><span class=language-xml><span class=hljs-tag>
  </span></span><span class=language-javascript>{found}</span><span class=language-xml><span class=hljs-tag>
  </span></span><span class=language-javascript>{visible}</span><span class=language-xml><span class=hljs-tag>
  </span></span><span class=language-javascript>{e}</span><span class=language-xml><span class=hljs-tag>
></span><span class=hljs-tag>&lt;/<span class=hljs-name>slot</span>></span></span></pre> </div><div class=contents style=display:none><pre class=svelte-m4suor>month,apples,bananas,cherries,dates
2015-04-01,3840,1920,960,400
2015-03-01,1600,1440,960,400
2015-02-01,640,960,640,400
2015-01-01,320,480,640,400</pre> </div></div></div></div></main> <script type=application/json data-type=svelte-data data-url=MultiLine.json>{"status":200,"statusText":"","headers":{"content-type":"application/json; charset=utf-8"},"body":"{\"main\":{\"title\":\"index.svelte\",\"contents\":\"\u003Cscript\u003E\\n  import { LayerCake, Svg, Html } from 'layercake';\\n  import { scaleOrdinal } from 'd3-scale';\\n  import { timeParse, timeFormat } from 'd3-time-format';\\n  import { format, precisionFixed } from 'd3-format';\\n\\n  import MultiLine from '.\u002Fcomponents\u002FMultiLine.svelte';\\n  import AxisX from '.\u002Fcomponents\u002FAxisX.svelte';\\n  import AxisY from '.\u002Fcomponents\u002FAxisY.svelte';\\n  import Labels from '.\u002Fcomponents\u002FGroupLabels.html.svelte';\\n  import SharedTooltip from '.\u002Fcomponents\u002FSharedTooltip.html.svelte';\\n\\n  \u002F\u002F This example loads csv data as json using @rollup\u002Fplugin-dsv\\n  import data from '.\u002Fdata\u002Ffruit.csv';\\n\\n  \u002F* --------------------------------------------\\n   * Set what is our x key to separate it from the other series\\n   *\u002F\\n  const xKey = 'month';\\n  const yKey = 'value';\\n  const zKey = 'fruit';\\n\\n  const seriesNames = Object.keys(data[0]).filter(d =\u003E d !== xKey);\\n  const seriesColors = ['#ffe4b8', '#ffb3c0', '#ff7ac7', '#ff00cc'];\\n\\n  const parseDate = timeParse('%Y-%m-%d');\\n\\n  \u002F* --------------------------------------------\\n   * Create a \\\"long\\\" format that is a grouped series of data points\\n   * Layer Cake uses this data structure and the key names\\n   * set in xKey, yKey and zKey to map your data into each scale.\\n   *\u002F\\n  const dataLong = seriesNames.map(key =\u003E {\\n    return {\\n      [zKey]: key,\\n      values: data.map(d =\u003E {\\n        d[xKey] = typeof d[xKey] === 'string' ? parseDate(d[xKey]) : d[xKey]; \u002F\u002F Conditional required for sapper\\n        return {\\n          [yKey]: +d[key],\\n          [xKey]: d[xKey]\\n        };\\n      })\\n    };\\n  });\\n\\n  \u002F* --------------------------------------------\\n   * Make a flat array of the `values` of our nested series\\n   * we can pluck the field set from `yKey` from each item\\n   * in the array to measure the full extents\\n   *\u002F\\n  const flatten = data =\u003E data.reduce((memo, group) =\u003E {\\n    return memo.concat(group.values);\\n  }, []);\\n\\n  const formatTickX = timeFormat('%b. %e');\\n  const formatTickY = d =\u003E format(`.${precisionFixed(d)}s`)(d);\\n\u003C\u002Fscript\u003E\\n\\n\u003Cstyle\u003E\\n  \u002F*\\n    The wrapper div needs to have an explicit width and height in CSS.\\n    It can also be a flexbox child or CSS grid element.\\n    The point being it needs dimensions since the \u003CLayerCake\u003E element will\\n    expand to fill it.\\n  *\u002F\\n  .chart-container {\\n    width: 100%;\\n    height: 100%;\\n  }\\n\u003C\u002Fstyle\u003E\\n\\n\u003Cdiv class=\\\"chart-container\\\"\u003E\\n  \u003CLayerCake\\n    padding={{ top: 7, right: 10, bottom: 20, left: 25 }}\\n    x={xKey}\\n    y={yKey}\\n    z={zKey}\\n    yDomain={[0, null]}\\n    zScale={scaleOrdinal()}\\n    zDomain={seriesNames}\\n    zRange={seriesColors}\\n    flatData={flatten(dataLong)}\\n    data={dataLong}\\n  \u003E\\n    \u003CSvg\u003E\\n      \u003CAxisX\\n        gridlines={false}\\n        ticks={data.map(d =\u003E d[xKey]).sort((a, b) =\u003E a - b)}\\n        formatTick={formatTickX}\\n        snapTicks={true}\\n        tickMarks={true}\\n      \u002F\u003E\\n      \u003CAxisY\\n        ticks={4}\\n        formatTick={formatTickY}\\n      \u002F\u003E\\n      \u003CMultiLine\u002F\u003E\\n    \u003C\u002FSvg\u003E\\n\\n    \u003CHtml\u003E\\n      \u003CLabels\u002F\u003E\\n      \u003CSharedTooltip\\n        formatTitle={formatTickX}\\n        dataset={data}\\n      \u002F\u003E\\n    \u003C\u002FHtml\u003E\\n  \u003C\u002FLayerCake\u003E\\n\u003C\u002Fdiv\u003E\"},\"dek\":\"A multiline example with a quadtree tooltip. This is an interesting example because the data exists in a few different structures:\\n\\n1. We're loading data from a \\\"wide\\\" format where each series has its own column name. We need to first turn this into...\\n2. ...a \\\"long\\\" format, where each type of fruit is grouped into its own array and each datapoint is a row. The column name becomes a property on the group whose name we define with the `zKey` variable.\\n3. We also need a flat, ungrouped array of objects so that Layer Cake can measure the full data extents. This gets passed to the `flatData` prop so the scales know the full domain of the data.\\n\",\"components\":[{\"title\":\".\u002Fcomponents\u002FMultiLine.svelte\",\"contents\":\"\u003Cscript\u003E\\n  \u002F**\\n    Generates an SVG multi-series line chart. It expects your data to be an array of objects, each with a `values` key that is an array of data objects.\\n  *\u002F\\n  import { getContext } from 'svelte';\\n\\n  const { data, xGet, yGet, zGet } = getContext('LayerCake');\\n\\n  $: path = values =\u003E {\\n    return 'M' + values\\n      .map(d =\u003E {\\n        return $xGet(d) + ',' + $yGet(d);\\n      })\\n      .join('L');\\n  };\\n\u003C\u002Fscript\u003E\\n\\n\u003Cg class=\\\"line-group\\\"\u003E\\n  {#each $data as group}\\n    \u003Cpath\\n      class='path-line'\\n      d='{path(group.values)}'\\n      stroke=\\\"{$zGet(group)}\\\"\\n    \u003E\u003C\u002Fpath\u003E\\n  {\u002Feach}\\n\u003C\u002Fg\u003E\\n\\n\u003Cstyle\u003E\\n  .path-line {\\n    fill: none;\\n    stroke-linejoin: round;\\n    stroke-linecap: round;\\n    stroke-width: 3px;\\n  }\\n\u003C\u002Fstyle\u003E\"},{\"title\":\".\u002Fcomponents\u002FAxisX.svelte\",\"contents\":\"\u003Cscript\u003E\\n  \u002F**\\n    Generates an SVG x-axis. This component is also configured to detect if your x-scale is an ordinal scale. If so, it will place the markers in the middle of the bandwidth.\\n    @type {Boolean} [gridlines=true] – Extend lines from the ticks into the chart space\\n    @type {Boolean} [tickMarks=false] – Show a vertical mark for each tick.\\n    @type {Boolean} [baseline=false] – Show a solid line at the bottom.\\n    @type {Boolean} [snapTicks=false] – Instead of centering the text on the first and the last items, align them to the edges of the chart.\\n    @type {Function} [formatTick=d =\u003E d] – A function that passes the current tick value and expects a nicely formatted value in return.\\n    @type {Number|Array|Function} [ticks] – If this is a number, it passes that along to the [d3Scale.ticks](https:\u002F\u002Fgithub.com\u002Fd3\u002Fd3-scale) function. If this is an array, hardcodes the ticks to those values. If it's a function, passes along the default tick values and expects an array of tick values in return. If nothing, it uses the default ticks supplied by the D3 function.\\n    @type {Number} [xTick=0] – TK\\n    @type {Number} [yTick=16] – The distance from the baseline to place each tick value.\\n  *\u002F\\n  import { getContext } from 'svelte';\\n\\n  const { width, height, xScale, yRange } = getContext('LayerCake');\\n\\n  export let gridlines = true;\\n  export let tickMarks = false;\\n  export let baseline = false;\\n  export let snapTicks = false;\\n  export let formatTick = d =\u003E d;\\n  export let ticks = undefined;\\n  export let xTick = 0;\\n  export let yTick = 16;\\n\\n  $: isBandwidth = typeof $xScale.bandwidth === 'function';\\n\\n  $: tickVals = Array.isArray(ticks) ? ticks :\\n    isBandwidth ?\\n      $xScale.domain() :\\n      typeof ticks === 'function' ?\\n        ticks($xScale.ticks()) :\\n          $xScale.ticks(ticks);\\n\\n  function textAnchor(i) {\\n    if (snapTicks === true) {\\n      if (i === 0) {\\n        return 'start';\\n      }\\n      if (i === tickVals.length - 1) {\\n        return 'end';\\n      }\\n    }\\n    return 'middle';\\n  }\\n\u003C\u002Fscript\u003E\\n\\n\u003Cg class='axis x-axis' class:snapTicks\u003E\\n  {#each tickVals as tick, i}\\n    \u003Cg class='tick tick-{ i }' transform='translate({$xScale(tick)},{$yRange[0]})'\u003E\\n      {#if gridlines !== false}\\n        \u003Cline class=\\\"gridline\\\" y1='{$height * -1}' y2='0' x1='0' x2='0'\u003E\u003C\u002Fline\u003E\\n      {\u002Fif}\\n      {#if tickMarks === true}\\n        \u003Cline class=\\\"tick-mark\\\" y1='{0}' y2='{6}' x1='{xTick || isBandwidth ? $xScale.bandwidth() \u002F 2 : 0}' x2='{xTick || isBandwidth ? $xScale.bandwidth() \u002F 2 : 0}'\u003E\u003C\u002Fline\u003E\\n      {\u002Fif}\\n      \u003Ctext\\n        x=\\\"{xTick || isBandwidth ? $xScale.bandwidth() \u002F 2 : 0}\\\"\\n        y='{yTick}'\\n        dx=''\\n        dy=''\\n        text-anchor='{textAnchor(i)}'\u003E{formatTick(tick)}\u003C\u002Ftext\u003E\\n    \u003C\u002Fg\u003E\\n  {\u002Feach}\\n  {#if baseline === true}\\n    \u003Cline class=\\\"baseline\\\" y1='{$height + 0.5}' y2='{$height + 0.5}' x1='0' x2='{$width}'\u003E\u003C\u002Fline\u003E\\n  {\u002Fif}\\n\u003C\u002Fg\u003E\\n\\n\u003Cstyle\u003E\\n  .tick {\\n    font-size: .725em;\\n    font-weight: 200;\\n  }\\n\\n  line,\\n  .tick line {\\n    stroke: #aaa;\\n    stroke-dasharray: 2;\\n  }\\n\\n  .tick text {\\n    fill: #666;\\n  }\\n\\n  .tick .tick-mark,\\n  .baseline {\\n    stroke-dasharray: 0;\\n  }\\n  \u002F* This looks slightly better *\u002F\\n  .axis.snapTicks .tick:last-child text {\\n    transform: translateX(3px);\\n  }\\n  .axis.snapTicks .tick.tick-0 text {\\n    transform: translateX(-3px);\\n  }\\n\u003C\u002Fstyle\u003E\"},{\"title\":\".\u002Fcomponents\u002FAxisY.svelte\",\"contents\":\"\u003Cscript\u003E\\n  \u002F**\\n    Generates an HTML y-axis.\\n    @type {Boolean} [gridlines=true] – Extend lines from the ticks into the chart space\\n    @type {Boolean} [tickMarks=false] – Show a vertical mark for each tick.\\n    @type {Function} [formatTick=d =\u003E d] – A function that passes the current tick value and expects a nicely formatted value in return.\\n    @type {Number|Array|Function} [ticks=4] – If this is a number, it passes that along to the [d3Scale.ticks](https:\u002F\u002Fgithub.com\u002Fd3\u002Fd3-scale) function. If this is an array, hardcodes the ticks to those values. If it's a function, passes along the default tick values and expects an array of tick values in return.\\n    @type {Number} [xTick=0] – How far over to position the text marker.\\n    @type {Number} [dxTick=0] – Any optional value passed to the `dx` attribute on the text marker and tick mark (if visible). This is ignored on the text marker if your scale is ordinal.\\n    @type {Number} [yTick=0] – How far up and down to position the text marker.\\n    @type {Number} [dyTick=0] – Any optional value passed to the `dy` attribute on the text marker and tick mark (if visible). This is ignored on the text marker if your scale is ordinal.\\n  *\u002F\\n  import { getContext } from 'svelte';\\n\\n  const { padding, xRange, yScale } = getContext('LayerCake');\\n\\n  export let gridlines = true;\\n  export let tickMarks = false;\\n  export let formatTick = d =\u003E d;\\n  export let ticks = 4;\\n  export let xTick = 0;\\n  export let yTick = 0;\\n  export let dxTick = 0;\\n  export let dyTick = -4;\\n  export let textAnchor = 'start';\\n\\n  $: isBandwidth = typeof $yScale.bandwidth === 'function';\\n\\n  $: tickVals = Array.isArray(ticks) ? ticks :\\n    isBandwidth ?\\n      $yScale.domain() :\\n      typeof ticks === 'function' ?\\n        ticks($yScale.ticks()) :\\n          $yScale.ticks(ticks);\\n\u003C\u002Fscript\u003E\\n\\n\u003Cg class='axis y-axis' transform='translate({-$padding.left}, 0)'\u003E\\n  {#each tickVals as tick}\\n    \u003Cg class='tick tick-{tick}' transform='translate({$xRange[0] + (isBandwidth ? $padding.left : 0)}, {$yScale(tick)})'\u003E\\n      {#if gridlines !== false}\\n        \u003Cline\\n          class=\\\"gridline\\\"\\n          x2='100%'\\n          y1={yTick + (isBandwidth ? ($yScale.bandwidth() \u002F 2) : 0)}\\n          y2={yTick + (isBandwidth ? ($yScale.bandwidth() \u002F 2) : 0)}\\n        \u003E\u003C\u002Fline\u003E\\n      {\u002Fif}\\n      {#if tickMarks === true}\\n        \u003Cline\\n          class='tick-mark'\\n          x1='0'\\n          x2='{isBandwidth ? -6 : 6}'\\n          y1={yTick + (isBandwidth ? ($yScale.bandwidth() \u002F 2) : 0)}\\n          y2={yTick + (isBandwidth ? ($yScale.bandwidth() \u002F 2) : 0)}\\n        \u003E\u003C\u002Fline\u003E\\n      {\u002Fif}\\n      \u003Ctext\\n        x='{xTick}'\\n        y='{yTick + (isBandwidth ? $yScale.bandwidth() \u002F 2 : 0)}'\\n        dx='{isBandwidth ? -9 : dxTick}'\\n        dy='{isBandwidth ? 4 : dyTick}'\\n        style=\\\"text-anchor:{isBandwidth ? 'end' : textAnchor};\\\"\\n      \u003E{formatTick(tick)}\u003C\u002Ftext\u003E\\n    \u003C\u002Fg\u003E\\n  {\u002Feach}\\n\u003C\u002Fg\u003E\\n\\n\u003Cstyle\u003E\\n  .tick {\\n    font-size: .725em;\\n    font-weight: 200;\\n  }\\n\\n  .tick line {\\n    stroke: #aaa;\\n  }\\n  .tick .gridline {\\n    stroke-dasharray: 2;\\n  }\\n\\n  .tick text {\\n    fill: #666;\\n  }\\n\\n  .tick.tick-0 line {\\n    stroke-dasharray: 0;\\n  }\\n\u003C\u002Fstyle\u003E\"},{\"title\":\".\u002Fcomponents\u002FGroupLabels.html.svelte\",\"contents\":\"\u003Cscript\u003E\\n  \u002F**\\n    Generates HTML text labels for a nested data structure. It places the label near the y-value of the highest x-valued data point. This is useful for labeling the final point in a multi-series line chart, for example. It expects your data to be an array of objects where each has `values` field that is an array of data objects. It uses the `z` field accessor to pull the text label.\\n  *\u002F\\n  import { getContext } from 'svelte';\\n  import { max } from 'd3-array';\\n\\n  const { data, x, y, xScale, yScale, xRange, yRange, z } = getContext('LayerCake');\\n\\n  \u002F* --------------------------------------------\\n   * Title case the first letter\\n   *\u002F\\n  const cap = val =\u003E val.replace(\u002F^\\\\w\u002F, d =\u003E d.toUpperCase());\\n\\n  \u002F* --------------------------------------------\\n   * Put the label on the highest value\\n   *\u002F\\n  $: left = values =\u003E $xScale(max(values, $x)) \u002F  Math.max(...$xRange);\\n  $: top = values =\u003E $yScale(max(values, $y)) \u002F Math.max(...$yRange);\\n\u003C\u002Fscript\u003E\\n\\n{#each $data as group}\\n  \u003Cdiv\\n    class=\\\"label\\\"\\n    style=\\\"\\n      top:{top(group.values) * 100}%;\\n      left:{left(group.values) * 100}%;\\n    \\\"\\n  \u003E{cap($z(group))}\u003C\u002Fdiv\u003E\\n{\u002Feach}\\n\\n\u003Cstyle\u003E\\n  .label {\\n    position: absolute;\\n    transform: translate(-100%, -100%)translateY(1px);\\n    font-size: 13px;\\n  }\\n\u003C\u002Fstyle\u003E\"},{\"title\":\".\u002Fcomponents\u002FSharedTooltip.html.svelte\",\"contents\":\"\u003Cscript\u003E\\n  \u002F**\\n    Generates a tooltip that works on multiseries datasets, like multiline charts. It creates a tooltip showing the name of the series and the current value. It finds the nearest data point using the [QuadTree.html.svelte](https:\u002F\u002Flayercake.graphics\u002Fcomponents\u002FQuadTree.html.svelte) component.\\n    @type {Function} [formatTitle=d =\u003E d] – A function to format the tooltip title, which is `$config.x`.\\n    @type {Function} [formatKey=d =\u003E titleCase(d)] – A function to format the series name.\\n    @type {Function} [formatValue=d =\u003E isNaN(+d) ? d : commas(d)] – A function to format the value.\\n    @type {Array} [dataset=$data] – The dataset to work off of. You can pass something custom in here in case you don't want to use the main data or it's in a strange format.\\n    @type {Number} [offset=20] – A negative y-offset from the hover point, in pixels.\\n    *\u002F\\n  import { getContext } from 'svelte';\\n  import { format } from 'd3-format';\\n\\n  import QuadTree from '.\u002FQuadTree.html.svelte';\\n\\n  const { data, width, yScale, config } = getContext('LayerCake');\\n\\n  const commas = format(',');\\n  const titleCase = d =\u003E d.replace(\u002F^\\\\w\u002F, w =\u003E w.toUpperCase());\\n\\n  export let offset = 20;\\n  export let dataset = $data;\\n  export let formatTitle = d =\u003E d;\\n  export let formatKey = d =\u003E titleCase(d);\\n  export let formatValue = d =\u003E isNaN(+d) ? d : commas(d);\\n\\n  const w = 150;\\n  const w2 = w \u002F 2;\\n\\n  \u002F* --------------------------------------------\\n   * Sort the keys by the highest value\\n   *\u002F\\n  function sortResult(result) {\\n    if (Object.keys(result).length === 0) return [];\\n    const rows = Object.keys(result).filter(d =\u003E d !== $config.x).map(key =\u003E {\\n      return {\\n        key,\\n        value: result[key]\\n      };\\n    }).sort((a, b) =\u003E b.value - a.value);\\n\\n    return rows;\\n  }\\n\u003C\u002Fscript\u003E\\n\\n\u003Cstyle\u003E\\n  .tooltip {\\n    position: absolute;\\n    font-size: 13px;\\n    pointer-events: none;\\n    border: 1px solid #ccc;\\n    background: rgba(255, 255, 255, 0.85);\\n    transform: translate(-50%, -100%);\\n    padding: 5px;\\n    z-index: 15;\\n    pointer-events: none;\\n  }\\n  .line {\\n    position: absolute;\\n    top: 0;\\n    bottom: 0;\\n    width: 1px;\\n    border-left: 1px dotted #666;\\n    pointer-events: none;\\n  }\\n  .tooltip,\\n  .line {\\n    transition: left 250ms ease-out, top 250ms ease-out;\\n  }\\n  .title {\\n    font-weight: bold;\\n  }\\n  .key {\\n    color: #999;\\n  }\\n\u003C\u002Fstyle\u003E\\n\\n\u003CQuadTree\\n  dataset={dataset}\\n  y='x'\\n  let:x\\n  let:y\\n  let:visible\\n  let:found\\n  let:e\\n\u003E\\n  {#if visible === true}\\n    \u003Cdiv\\n      style=\\\"left:{x}px;\\\"\\n      class=\\\"line\\\"\u003E\u003C\u002Fdiv\u003E\\n    \u003Cdiv\\n      class=\\\"tooltip\\\"\\n      style=\\\"\\n        width:{w}px;\\n        display: { visible ? 'block' : 'none' };\\n        top:{$yScale(sortResult(found)[0].value) - offset}px;\\n        left:{Math.min(Math.max(w2, x), $width - w2)}px;\\\"\\n      \u003E\\n        \u003Cdiv class=\\\"title\\\"\u003E{formatTitle(found[$config.x])}\u003C\u002Fdiv\u003E\\n        {#each sortResult(found) as row}\\n          \u003Cdiv class=\\\"row\\\"\u003E\u003Cspan class=\\\"key\\\"\u003E{formatKey(row.key)}:\u003C\u002Fspan\u003E {formatValue(row.value)}\u003C\u002Fdiv\u003E\\n        {\u002Feach}\\n    \u003C\u002Fdiv\u003E\\n  {\u002Fif}\\n\u003C\u002FQuadTree\u003E\"}],\"modules\":[],\"componentModules\":[],\"componentComponents\":[{\"title\":\".\u002Fcomponents\u002FQuadTree.html.svelte\",\"contents\":\"\u003Cscript\u003E\\n  \u002F**\\n    Creates an interaction layer (in HTML) using [d3-quadtree](https:\u002F\u002Fgithub.com\u002Fd3\u002Fd3-quadtree) to find the nearest datapoint to the mouse. This component creates a slot that exposes variables `x`, `y`, `found` (the found datapoint), `visible` (a Boolean whether any data was found) and `e` (the event object).\\n\\n    The quadtree searches across both the x and y dimensions at the same time. But if you want to only search across one, set the `x` and `y` props to the same value. For example, the [shared tooltip component](https:\u002F\u002Flayercake.graphics\u002Fcomponents\u002FSharedTooltip.html.svelte) sets `y='x'` since it's nicer behavior to only pick up on the nearest x-value.\\n    @type {String} [searchRadius=undefined] – The number of pixels to search around the mouse's location. This is the third argument passed to [`quadtree.find`](https:\u002F\u002Fgithub.com\u002Fd3\u002Fd3-quadtree#quadtree_find) and by default a value of `undefined` means an unlimited range.\\n    @type {String} [x='x'] – The dimension to search across when moving the mouse left and right.\\n    @type {String} [y='y'] – The dimension to search across when moving the mouse up and down.\\n    @type {Array} [dataset=$data] – The dataset to work off of. You can pass something custom in here in case you don't want to use the main data or it's in a strange format.\\n  *\u002F\\n  import { getContext } from 'svelte';\\n  import { quadtree } from 'd3-quadtree';\\n\\n  const { data, xGet, yGet, width, height } = getContext('LayerCake');\\n\\n  let visible = false;\\n  let found = {};\\n  let e = {};\\n\\n  export let dataset = undefined;\\n  export let x = 'x';\\n  export let y = 'y';\\n  export let searchRadius = undefined;\\n\\n  $: xGetter = x === 'x' ? $xGet : $yGet;\\n  $: yGetter = y === 'y' ? $yGet : $xGet;\\n\\n  function findItem (evt) {\\n    e = evt;\\n\\n    const xLayerKey = `layer${x.toUpperCase()}`;\\n    const yLayerKey = `layer${y.toUpperCase()}`;\\n\\n    console.log('evt', evt[xLayerKey], evt[yLayerKey]);\\n\\n    found = finder.find(evt[xLayerKey], evt[yLayerKey], searchRadius) || {};\\n    visible = Object.keys(found).length \u003E 0;\\n  }\\n\\n  $: finder = quadtree()\\n    .extent([[-1, -1], [$width + 1, $height + 1]])\\n    .x(xGetter)\\n    .y(yGetter)\\n    .addAll(dataset || $data);\\n\u003C\u002Fscript\u003E\\n\\n\u003Cstyle\u003E\\n  .bg {\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    bottom: 0;\\n    left: 0;\\n  }\\n\u003C\u002Fstyle\u003E\\n\\n\u003Cdiv\\n  class=\\\"bg\\\"\\n  on:mousemove=\\\"{findItem}\\\"\\n  on:mouseout=\\\"{() =\u003E visible = false}\\\"\\n  on:blur=\\\"{() =\u003E visible = false}\\\"\\n\u003E\u003C\u002Fdiv\u003E\\n\u003Cslot\\n  x={xGetter(found) || 0}\\n  y={yGetter(found) || 0}\\n  {found}\\n  {visible}\\n  {e}\\n\u003E\u003C\u002Fslot\u003E\"}],\"csvs\":[{\"title\":\".\u002Fdata\u002Ffruit.csv\",\"contents\":\"month,apples,bananas,cherries,dates\\n2015-04-01,3840,1920,960,400\\n2015-03-01,1600,1440,960,400\\n2015-02-01,640,960,640,400\\n2015-01-01,320,480,640,400\"}],\"jsons\":[]}"}</script> </div> 